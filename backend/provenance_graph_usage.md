# ProvenanceGraph æ‰“å°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

`ProvenanceGraph` ç±»æä¾›äº†å¤šç§æ‰“å°åŠŸèƒ½ï¼Œå¸®åŠ©æ‚¨ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ¥æºæ‹“æ‰‘å›¾çš„ç»“æ„ã€‚è¿™äº›åŠŸèƒ½åŒ…æ‹¬åŸºæœ¬æ‰“å°ã€è¯¦ç»†æ‰“å°ã€å®ä½“è¡€ç»Ÿæ‰“å°ã€æ´»åŠ¨å·¥ä½œæµæ‰“å°ç­‰ã€‚

## åŸºæœ¬æ‰“å°åŠŸèƒ½

### 1. å­—ç¬¦ä¸²è¡¨ç¤º

```python
from provenance_graph import ProvenanceGraph

# åˆ›å»ºå›¾å®ä¾‹
graph = ProvenanceGraph()

# åŸºæœ¬å­—ç¬¦ä¸²è¡¨ç¤º
print(graph)  # è¾“å‡º: ProvenanceGraph(nodes=5, edges=4, entities=3, activities=2)
```

### 2. èŠ‚ç‚¹å’Œè¾¹çš„æ‰“å°

```python
# æ‰“å°å•ä¸ªèŠ‚ç‚¹
for node in graph.nodes.values():
    print(node)  # è¾“å‡º: Entity(1: åŸå§‹æ•°æ®æ–‡ä»¶)

# æ‰“å°å•ä¸ªè¾¹
for edge in graph.edges:
    print(edge)  # è¾“å‡º: 1 --used [input]--> 4
```

## è¯¦ç»†å›¾ç»“æ„æ‰“å°

### åŸºæœ¬æ‰“å°

```python
# æ‰“å°å›¾çš„åŸºæœ¬ç»“æ„
graph.print_graph()
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
æ¥æºæ‹“æ‰‘å›¾ç»“æ„
============================================================
èŠ‚ç‚¹æ€»æ•°: 5
  - å®ä½“èŠ‚ç‚¹: 3
  - æ´»åŠ¨èŠ‚ç‚¹: 2
è¾¹æ€»æ•°: 4

èŠ‚ç‚¹å±‚çº§ç»“æ„:
----------------------------------------
å±‚çº§ 0:
  Entity(1: åŸå§‹æ•°æ®æ–‡ä»¶)

å±‚çº§ 1:
  Entity(2: æ¸…æ´—åæ•°æ®)
  Activity(4: æ•°æ®æ¸…æ´—)

å±‚çº§ 2:
  Entity(3: åˆ†ææŠ¥å‘Š)
  Activity(5: æ•°æ®åˆ†æ)

è¾¹å…³ç³»:
----------------------------------------
  åŸå§‹æ•°æ®æ–‡ä»¶ --used [input]--> æ•°æ®æ¸…æ´—
  æ•°æ®æ¸…æ´— --was_generated_by [output]--> æ¸…æ´—åæ•°æ®
  æ¸…æ´—åæ•°æ® --used [input]--> æ•°æ®åˆ†æ
  æ•°æ®åˆ†æ --was_generated_by [output]--> åˆ†ææŠ¥å‘Š
============================================================
```

### è¯¦ç»†æ‰“å°

```python
# æ‰“å°å›¾çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬ä½ç½®ã€æ—¶é—´ç­‰ï¼‰
graph.print_graph(detailed=True)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
æ¥æºæ‹“æ‰‘å›¾ç»“æ„
============================================================
èŠ‚ç‚¹æ€»æ•°: 5
  - å®ä½“èŠ‚ç‚¹: 3
  - æ´»åŠ¨èŠ‚ç‚¹: 2
è¾¹æ€»æ•°: 4

èŠ‚ç‚¹å±‚çº§ç»“æ„:
----------------------------------------
å±‚çº§ 0:
  Entity(1: åŸå§‹æ•°æ®æ–‡ä»¶)

å±‚çº§ 1:
  Entity(2: æ¸…æ´—åæ•°æ®)
  Activity(4: æ•°æ®æ¸…æ´—)

å±‚çº§ 2:
  Entity(3: åˆ†ææŠ¥å‘Š)
  Activity(5: æ•°æ®åˆ†æ)

è¾¹å…³ç³»:
----------------------------------------
  åŸå§‹æ•°æ®æ–‡ä»¶ --used [input]--> æ•°æ®æ¸…æ´—
  æ•°æ®æ¸…æ´— --was_generated_by [output]--> æ¸…æ´—åæ•°æ®
  æ¸…æ´—åæ•°æ® --used [input]--> æ•°æ®åˆ†æ
  æ•°æ®åˆ†æ --was_generated_by [output]--> åˆ†ææŠ¥å‘Š

è¯¦ç»†ä¿¡æ¯:
----------------------------------------
èŠ‚ç‚¹è¯¦æƒ…:
  Entity(1: åŸå§‹æ•°æ®æ–‡ä»¶) (å±‚çº§: 0)
    ä½ç½®: /data/raw/file1.csv

  Entity(2: æ¸…æ´—åæ•°æ®) (å±‚çº§: 1)
    ä½ç½®: /data/cleaned/file2.csv

  Entity(3: åˆ†ææŠ¥å‘Š) (å±‚çº§: 2)
    ä½ç½®: /reports/analysis.pdf

  Activity(4: æ•°æ®æ¸…æ´—) (å±‚çº§: 1)
    å¼€å§‹æ—¶é—´: 2024-01-01 10:00:00
    ç»“æŸæ—¶é—´: 2024-01-01 11:00:00

  Activity(5: æ•°æ®åˆ†æ) (å±‚çº§: 2)
    å¼€å§‹æ—¶é—´: 2024-01-01 14:00:00
    ç»“æŸæ—¶é—´: 2024-01-01 16:00:00
============================================================
```

## å®ä½“è¡€ç»Ÿæ‰“å°

```python
# è·å–å¹¶æ‰“å°å®ä½“çš„è¡€ç»Ÿä¿¡æ¯
entity = some_entity  # æ‚¨çš„å®ä½“å¯¹è±¡
graph.print_entity_lineage(entity)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
å®ä½“è¡€ç»Ÿ: åˆ†ææŠ¥å‘Š (ID: 3)
============================================================
æ ¹å®ä½“: åˆ†ææŠ¥å‘Š
ä½ç½®: /reports/analysis.pdf

è¡€ç»Ÿå±‚çº§:
----------------------------------------
å±‚çº§ 0:
  ğŸ“„ åˆ†ææŠ¥å‘Š (entity)

å±‚çº§ 1:
  ğŸ“„ æ¸…æ´—åæ•°æ® (entity)

å±‚çº§ 2:
  ğŸ“„ åŸå§‹æ•°æ®æ–‡ä»¶ (entity)

å…³ç³»è¾¹:
----------------------------------------
  æ¸…æ´—åæ•°æ® --was_derived_from [source]--> åˆ†ææŠ¥å‘Š
  åŸå§‹æ•°æ®æ–‡ä»¶ --was_derived_from [source]--> æ¸…æ´—åæ•°æ®

æ€»è®¡: 3 ä¸ªèŠ‚ç‚¹, 2 æ¡è¾¹
============================================================
```

## æ´»åŠ¨å·¥ä½œæµæ‰“å°

```python
# è·å–å¹¶æ‰“å°æ´»åŠ¨çš„å·¥ä½œæµä¿¡æ¯
activity = some_activity  # æ‚¨çš„æ´»åŠ¨å¯¹è±¡
graph.print_activity_workflow(activity)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
æ´»åŠ¨å·¥ä½œæµ: æ•°æ®åˆ†æ (ID: 2)
============================================================
æ ¹æ´»åŠ¨: æ•°æ®åˆ†æ
å¼€å§‹æ—¶é—´: 2024-01-01T14:00:00
ç»“æŸæ—¶é—´: 2024-01-01T16:00:00

å·¥ä½œæµå±‚çº§:
----------------------------------------
å±‚çº§ 0:
  âš™ï¸ æ•°æ®åˆ†æ (activity)

å±‚çº§ 1:
  ğŸ“„ æ¸…æ´—åæ•°æ® (entity)

å±‚çº§ 2:
  ğŸ“„ åŸå§‹æ•°æ®æ–‡ä»¶ (entity)

å…³ç³»è¾¹:
----------------------------------------
  æ¸…æ´—åæ•°æ® --used [input]--> æ•°æ®åˆ†æ
  åŸå§‹æ•°æ®æ–‡ä»¶ --was_derived_from [source]--> æ¸…æ´—åæ•°æ®

æ€»è®¡: 3 ä¸ªèŠ‚ç‚¹, 2 æ¡è¾¹
============================================================
```

## å­—å…¸æ ¼å¼è½¬æ¢

```python
# å°†å›¾è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œä¾¿äºJSONåºåˆ—åŒ–
graph_dict = graph.to_dict()
print(json.dumps(graph_dict, indent=2, ensure_ascii=False))
```

è¾“å‡ºç¤ºä¾‹ï¼š

```json
{
  "nodes": [
    {
      "id": 1,
      "name": "åŸå§‹æ•°æ®æ–‡ä»¶",
      "type": "entity",
      "level": 0,
      "data_type": "Entity"
    },
    {
      "id": 2,
      "name": "æ¸…æ´—åæ•°æ®",
      "type": "entity",
      "level": 1,
      "data_type": "Entity"
    }
  ],
  "edges": [
    {
      "source": 1,
      "target": 4,
      "type": "used",
      "role": "input"
    }
  ],
  "levels": {
    "1": 0,
    "4": 1,
    "2": 1,
    "5": 2,
    "3": 2
  },
  "statistics": {
    "total_nodes": 5,
    "total_edges": 4,
    "entity_nodes": 3,
    "activity_nodes": 2
  }
}
```

## ä½¿ç”¨å»ºè®®

1. **è°ƒè¯•æ—¶**: ä½¿ç”¨ `graph.print_graph()` æŸ¥çœ‹åŸºæœ¬ç»“æ„
2. **è¯¦ç»†åˆ†æ**: ä½¿ç”¨ `graph.print_graph(detailed=True)` æŸ¥çœ‹å®Œæ•´ä¿¡æ¯
3. **å®ä½“è¿½è¸ª**: ä½¿ç”¨ `graph.print_entity_lineage(entity)` è¿½è¸ªå®ä½“è¡€ç»Ÿ
4. **å·¥ä½œæµåˆ†æ**: ä½¿ç”¨ `graph.print_activity_workflow(activity)` åˆ†ææ´»åŠ¨æµç¨‹
5. **æ•°æ®å¯¼å‡º**: ä½¿ç”¨ `graph.to_dict()` è½¬æ¢ä¸º JSON æ ¼å¼

## å›¾æ ‡è¯´æ˜

- ğŸ“„ : å®ä½“èŠ‚ç‚¹
- âš™ï¸ : æ´»åŠ¨èŠ‚ç‚¹

## å…³ç³»ç±»å‹

- `used`: æ´»åŠ¨ä½¿ç”¨å®ä½“
- `was_generated_by`: å®ä½“ç”±æ´»åŠ¨ç”Ÿæˆ
- `was_derived_from`: å®ä½“ä»å…¶ä»–å®ä½“è¡ç”Ÿ
- `was_informed_by`: æ´»åŠ¨è¢«å…¶ä»–æ´»åŠ¨é€šçŸ¥
